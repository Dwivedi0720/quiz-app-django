{% extends 'base.html' %}

{% block title %}Quiz Result{% endblock %}

{% block content %}
<div style="padding: 4rem 0;">
    <div class="container">
        <div class="result-card">
            <h2>üéØ Quiz Completed!</h2>
            <div class="result-score {% if is_passed %}pass{% else %}fail{% endif %}">
                {{ attempt.percentage|floatformat:1 }}%
            </div>
            <h3>{% if is_passed %}üéâ Congratulations! You Passed!{% else %}üòî Keep Trying!{% endif %}</h3>
            
            <div class="result-details">
                <div class="result-detail-item">
                    <div class="result-detail-label">Score</div>
                    <div class="result-detail-value">{{ attempt.score }}/{{ attempt.total_marks }}</div>
                </div>
                <div class="result-detail-item">
                    <div class="result-detail-label">Correct</div>
                    <div class="result-detail-value" style="color: var(--success);">{{ attempt.answers.filter.is_correct=True.count }}</div>
                </div>
                <div class="result-detail-item">
                    <div class="result-detail-label">Incorrect</div>
                    <div class="result-detail-value" style="color: var(--danger);">{{ attempt.answers.filter.is_correct=False.count }}</div>
                </div>
                <div class="result-detail-item">
                    <div class="result-detail-label">Time Taken</div>
                    <div class="result-detail-value">{{ attempt.time_taken|floatformat:0 }}s</div>
                </div>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                <a href="{% url 'progress:dashboard' %}" class="btn btn-primary">Go to Dashboard</a>
                <a href="{% url 'quiz:quiz_list' %}" class="btn btn-secondary">Browse More Quizzes</a>
            </div>
        </div>

        <div class="card" style="margin-top: 2rem;">
            <div class="card-header">
                <h2>üìù Review Answers</h2>
            </div>
            <div class="card-body">
                {% for qa in questions_with_answers %}
                <div class="question-container">
                    <div class="question-header">
                        <div class="question-number">Question {{ forloop.counter }}</div>
                        {% if qa.answer.is_correct %}
                        <span class="badge badge-success">‚úì Correct</span>
                        {% else %}
                        <span class="badge badge-danger">‚úó Incorrect</span>
                        {% endif %}
                    </div>
                    <div class="question-text">{{ qa.question.question_text }}</div>
                    <div class="options">
                        <div class="option {% if qa.answer and qa.answer.selected_answer == 'A' %}{% if qa.answer.is_correct %}correct{% else %}incorrect{% endif %}{% elif qa.question.correct_answer == 'A' %}correct{% endif %}">
                            <div class="option-label">A</div>
                            <span>{{ qa.question.option_a }}</span>
                            {% if qa.question.correct_answer == 'A' %}<span style="margin-left: auto; color: var(--success);">‚úì Correct Answer</span>{% endif %}
                        </div>
                        <div class="option {% if qa.answer and qa.answer.selected_answer == 'B' %}{% if qa.answer.is_correct %}correct{% else %}incorrect{% endif %}{% elif qa.question.correct_answer == 'B' %}correct{% endif %}">
                            <div class="option-label">B</div>
                            <span>{{ qa.question.option_b }}</span>
                            {% if qa.question.correct_answer == 'B' %}<span style="margin-left: auto; color: var(--success);">‚úì Correct Answer</span>{% endif %}
                        </div>
                        <div class="option {% if qa.answer and qa.answer.selected_answer == 'C' %}{% if qa.answer.is_correct %}correct{% else %}incorrect{% endif %}{% elif qa.question.correct_answer == 'C' %}correct{% endif %}">
                            <div class="option-label">C</div>
                            <span>{{ qa.question.option_c }}</span>
                            {% if qa.question.correct_answer == 'C' %}<span style="margin-left: auto; color: var(--success);">‚úì Correct Answer</span>{% endif %}
                        </div>
                        <div class="option {% if qa.answer and qa.answer.selected_answer == 'D' %}{% if qa.answer.is_correct %}correct{% else %}incorrect{% endif %}{% elif qa.question.correct_answer == 'D' %}correct{% endif %}">
                            <div class="option-label">D</div>
                            <span>{{ qa.question.option_d }}</span>
                            {% if qa.question.correct_answer == 'D' %}<span style="margin-left: auto; color: var(--success);">‚úì Correct Answer</span>{% endif %}
                        </div>
                    </div>
                    {% if qa.question.explanation %}
                    <div style="margin-top: 1rem; padding: 1rem; background: var(--light); border-radius: 10px;">
                        <strong>Explanation:</strong> {{ qa.question.explanation }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}